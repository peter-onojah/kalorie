{% extends 'base.html' %}

{% block title %}Stock Management{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Stock Management</h2>
    <div>
        <a href="{% url 'add_stock' %}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Add Stock
        </a>
        <a href="{% url 'stock_history' %}" class="btn btn-info">
            <i class="fas fa-history"></i> View History
        </a>
    </div>
</div>

<div class="row">
    {% for stock in stocks %}
    <div class="col-md-4 mb-4">
        <div class="card {% if stock.is_low_stock %}border-warning{% endif %}">
            <div class="card-header {% if stock.is_low_stock %}bg-warning text-dark{% else %}bg-success text-white{% endif %}">
                <h5 class="mb-0">{{ stock.get_category_display }}</h5>
            </div>
            <div class="card-body">
                <h2 class="text-center mb-3">{{ stock.quantity }} <small class="text-muted">crates</small></h2>
                
                <div class="progress mb-3" style="height: 10px;">
                    {% if stock.category == 'SMALL' %}
                        {% with threshold=200 %}
                        <div class="progress-bar bg-info" style="width: {% widthratio stock.quantity threshold 100 %}%"></div>
                        {% endwith %}
                    {% elif stock.category == 'MEDIUM' %}
                        {% with threshold=200 %}
                        <div class="progress-bar bg-info" style="width: {% widthratio stock.quantity threshold 100 %}%"></div>
                        {% endwith %}
                    {% else %}
                        {% with threshold=200 %}
                        <div class="progress-bar bg-info" style="width: {% widthratio stock.quantity threshold 100 %}%"></div>
                        {% endwith %}
                    {% endif %}
                </div>
                
                <div class="row text-center">
                    <div class="col-6">
                        <small class="text-muted d-block">Threshold</small>
                        <strong>{{ stock.low_stock_threshold }}</strong>
                    </div>
                    <div class="col-6">
                        <small class="text-muted d-block">Last Updated</small>
                        <strong>{{ stock.last_updated|date:"M d, H:i" }}</strong>
                    </div>
                </div>
                
                {% if stock.is_low_stock %}
                <div class="alert alert-warning mt-3 mb-0 py-2">
                    <i class="fas fa-exclamation-triangle"></i> Low Stock Alert!
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12">
        <div class="alert alert-info">
            No stock records found. <a href="{% url 'add_stock' %}">Add your first stock</a>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}